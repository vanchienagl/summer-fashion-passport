
(function($,window,undefined){Main=function(){this.$win=$(window);this.$body=$('body');this.$calendar=$('.js-calendar');this.$eventsListsTlEventtype=$('.eventsLists_tl_eventtype');this.$eventsLists=$('.eventsLists');this.$calendarBtn=$('.js-calender_btn');this.$$calendarFunc;this.today=new Date();this.search='?date='+this.today.getFullYear()+(this.today.getMonth()+1)+this.today.getDate()+this.today.getHours()+this.today.getMinutes()+this.today.getSeconds();this.today_year=this.today.getFullYear();this.today_month=this.today.getMonth()+1;this.today_date=this.today.getDate();this.today_month_Str=('0'+this.today_month).slice(-2);this.today_date_Str=('0'+this.today_date).slice(-2);this.today_str=`${this.today_year}-${this.today_month_Str}-${this.today_date_Str}`;this.calendarEnddate=new Date();this.curCalendarType=$('.js-calender_btn.is-on').attr('data-calender-period');this.curCalendarDate=new Date();this.curCalendarDate_year=this.curCalendarDate.getFullYear();this.curCalendarDate_month=this.curCalendarDate.getMonth()+1;this.curCalendarDate_date=this.curCalendarDate.getDate();this.curCalendarDate_month_Str=('0'+this.curCalendarDate_month).slice(-2);this.curCalendarDate_date_Str=('0'+this.curCalendarDate_date).slice(-2);this.curCalendarDate_str=`${this.curCalendarDate_year}-${this.curCalendarDate_month_Str}-${this.curCalendarDate_date_Str}`;this.jsonUrl='';this.hostname=location.hostname;this.pathname=location.pathname;this.jsonArr;this.sortedJsonArr=[];this.curCalendarLocationid='1';this.$anm=$('.js-anm');this.anmInfo=[];this.scT=0;this.tmpScT=0;this.winW=this.$win.width();this.winH=this.$win.height();this.deviceType='PC';this.deviceTypeThreshold=640;this.scTGap=()=>{return(this.winH*0.6);};this.dataArr;this.$anm=$('.js-anm');this.texts={"noEvents":"該当するイベントがありません。","centers":{"1":{"name":"御殿場プレミアム・アウトレット","dir":"gotemba"},"2":{"name":"りんくうプレミアム・アウトレット","dir":"rinku"},"3":{"name":"佐野プレミアム・アウトレット","dir":"sano"},"4":{"name":"鳥栖プレミアム・アウトレット","dir":"tosu"},"5":{"name":"土岐プレミアム・アウトレット","dir":"toki"},"6":{"name":"神戸三田プレミアム・アウトレット","dir":"kobesanda"},"7":{"name":"仙台泉プレミアム・アウトレット","dir":"sendaiizumi"},"8":{"name":"あみプレミアム・アウトレット","dir":"ami"},"9":{"name":"酒々井プレミアム・アウトレット","dir":"shisui"},"10":{"name":"ふかや花園プレミアム・アウトレット","dir":"fukayahanazono"}},"categoryType":{"100":{"name":"ショップニュース"},"200":{"name":"プレミアム・アウトレットニュース"},"300":{"name":"期間限定ショップ"},"900":{"name":""},"4":{"name":""},"5":{"name":""},"6":{"name":""},"7":{"name":""},"8":{"name":""},"9":{"name":"NEWSページ非表示"}},"categoryOrder":["2","9","1","3"],"$$eventsListsTlEventtype":(type,date)=>{let txt='';if(type==='date'){const curDate=new Date(date);txt=`<span class="nowrap">${curDate.getFullYear()}年</span><span class="nowrap">${curDate.getMonth() + 1}月</span><span class="nowrap">${curDate.getDate()}日</span><span class="nowrap">の</span><span class="nowrap">イベント</span>`;}else{if(this.$$calendarFunc){txt=`${this.dateToTxt(this.$$calendarFunc.getDate())}<span class="nowrap">の</span><span class="nowrap">イベント</span>`;}else{txt=`${this.dateToTxt(this.today)}<span class="nowrap">の</span><span class="nowrap">イベント</span>`;}}
return txt;}};this.isFirst=false;this.init();};Main.prototype={init:function(){const s=this;let oldDeviceType=this.deviceType;if(this.winW>s.deviceTypeThreshold){this.deviceType='PC';}else{this.deviceType='SP';};for(let key in this.texts['centers']){if(this.pathname.indexOf(this.texts['centers'][key]['dir'])>-1){const center=this.texts['centers'][key]['dir'];console.log('center:',center)
this.curCalendarLocationid=key;this.jsonUrl=`/api/v1/${center}/news`;}};console.log('jsonUrl:',this.jsonUrl)
fetch(this.jsonUrl).then((response)=>response.json()).then((result)=>{this.jsonArr=result;console.log('result:',this.jsonArr);this.jsonSort();}).catch((error)=>{console.error("Error:",error);});this.$calendarBtn.each((i,el)=>{const $s=$(el),type=$s.attr('data-calender-period');$s.on('click',(e)=>{e.preventDefault();s.$calendarBtn.removeClass('is-on');$s.addClass('is-on');if(type==='date'){s.outputEvents(type,s.today_str,'');}else{s.curCalendarDate=s.$$calendarFunc.getDate();s.curCalendarDateUpdate();s.outputEvents(type,s.curCalendarDate_str,'');}})})
$('a').not('.modal').each((i,el)=>{const $s=$(el),href=$s.attr('href');if($s.attr('href')){if(href.match(/^#/)&&href!=='#'){$s.on('click',(e)=>{e.preventDefault();if($(href).length>0){s.pageTo(href);}});};};});window.addEventListener('load',(event)=>{if($('.js-anm')[0]){s.$anm.each((i,el)=>{const $s=$(el);let start=$s.offset().top,end=$s.offset().top+$s.outerHeight(),id=$s.attr('id');if(!id){id='js-anm-'+i;$s.attr('id',id);};s.anmInfo[Object.keys(s.anmInfo).length]={'$obj':$s,'id':id,'class':$s.attr('class'),'start':start,'end':end,'completeFlg':false,'$objs':{}};$s.find('.js-anmTarget').each((j,el2)=>{const $s2=$(el2);let order=0,anmType='',anmDelay=0,id2=$s2.attr('id');if($s2.attr('data-anmOrder')){order=Number($s2.attr('data-anmOrder'));}else{order=j;}
if($s2.attr('data-anmType')){anmType=$s2.attr('data-anmType');}
if($s2.attr('data-anmDelay')){anmDelay=Number($(this).attr('data-anmDelay'));}
if(!id2){id2='js-anm-'+i+'-'+order;$s2.attr('id',id2);};s.anmInfo[Object.keys(s.anmInfo).length-1]['$objs'][order]={'$target':$s2,'id':id2,'class':$s2.attr('class'),'anmType':anmType,'anmDelay':anmDelay};});});};setTimeout(()=>{s.onResize();},200);});s.$win.on('resize',$.proxy(s.onResize,s));s.$win.on('scroll',$.proxy(s.onScroll,s));},onScroll:function(){const s=this,spd=1000,rate=1;this.scT=document.documentElement.scrollTop||document.body.scrollTop;if(Object.keys(this.anmInfo).length>0){for(let key in this.anmInfo){let $target=this.anmInfo[key],gap=this.scTGap();if($target['start']<=s.scT+gap&&$target['end']>s.scT&&!$target['completeFlg']){$target['completeFlg']=true;if($target['$obj'].hasClass('is-customAnm')){$target['$obj'].addClass('js-anm-on');s['$$'+s.pageId][$target['$obj'].attr('data-anmId')+'Anm']($target['$obj'],$target['$anmTarget']);}else{if(s.deviceType==='PC'&&$target['$obj'].attr('data-anmDelay-pc')){delay=delay+($target['$obj'].attr('data-anmDelay-pc')*spd);}else if(s.deviceType==='SP'&&$target['$obj'].attr('data-anmDelay-sp')){delay=delay+($target['$obj'].attr('data-anmDelay-sp')*spd);}else if($target['$obj'].attr('data-anmDelay')){delay=delay+($target['$obj'].attr('data-anmDelay')*spd);};$target['$obj'].addClass('js-anm-on');$.each($target['$anmTarget'],(j,val2)=>{let order=j,delay2=delay;if(s.deviceType==='PC'&&val2['$obj'].attr('data-anmDelay-pc')){delay2=delay2+(val2['$obj'].attr('data-anmDelay-pc')*spd);}else if(s.deviceType==='SP'&&val2['$obj'].attr('data-anmDelay-sp')){delay2=delay2+(val2['$obj'].attr('data-anmDelay-sp')*spd);}else if(val2['$obj'].attr('data-anmDelay')){delay2=delay2+(val2['$obj'].attr('data-anmDelay')*spd);};setTimeout(()=>{val2['$obj'].addClass('js-anm-on');},((spd*rate)*order)+delay2);});}};}};},onResize:function(){const s=this;let oldDeviceType=this.deviceType;this.winW=this.$win.width();this.winH=this.$win.height();if(this.winW>s.deviceTypeThreshold){this.deviceType='PC';}else{this.deviceType='SP';};if(Object.keys(this.anmInfo).length>0){for(let key in this.anmInfo){let $target=$('#'+this.anmInfo[key]['id']);this.anmInfo[key]['start']=$target.offset().top;this.anmInfo[key]['end']=$target.offset().top+$target.outerHeight();};};this.onScroll();},pageTo:function(hash){const oft=$(hash).offset().top;;$('html, body').animate({scrollTop:oft},500,'swing');},jsonSort:function(){const s=this;const jsonSchedule=this.jsonArr.schedule;const jsonNews=this.jsonArr.news;console.log('jsonNews:>>>>>>>>>>>>>>>>>>>',jsonNews)
for(var i=0;i<jsonSchedule.length;i++){const enddate=new Date(jsonSchedule[i]['schedule_enddate']);if(new Date(this.today.toDateString()).getTime()<=new Date(enddate.toDateString()).getTime()){const newsId=Number(jsonSchedule[i].newsid);for(var j=0;j<jsonNews.length;j++){if(newsId===Number(jsonNews[j].newsid)){const startObj=Object.assign({},jsonNews[j],{'schedule_startdate':jsonSchedule[i]['schedule_startdate']})
const endObj=Object.assign({},jsonNews[j],{'schedule_enddate':jsonSchedule[i]['schedule_enddate']})
const margeObj=Object.assign({},jsonNews[j],startObj,endObj);this.sortedJsonArr.push(margeObj);}}}}
console.log('中間:',this.sortedJsonArr)
const sortList=[];for(var i=0;i<this.jsonArr.news.length;i++){const aNewsId=this.jsonArr.news[i].newsid;for(var j=0;j<this.sortedJsonArr.length;j++){const bNewsId=this.sortedJsonArr[j].newsid;if(aNewsId===bNewsId){sortList.push(this.sortedJsonArr[j]);}}}
console.log('sortList=============',sortList)
this.sortedJsonArr=sortList;console.log('this.sortedJsonArr=============',this.sortedJsonArr)
const desiredSort=[200,100,300];let sortPO=_.filter(this.sortedJsonArr,{"category02":200});let sortOTHER1=_.filter(this.sortedJsonArr,{"category02":100});let sortOTHER2=_.filter(this.sortedJsonArr,{"category02":300});let sortEventCalender=_.filter(this.sortedJsonArr,{"category02":900});let sortPO1=[];let sortPO2=[];let sortList1=[]
console.log('sortOTHER1:>',sortOTHER1)
console.log('sortOTHER2:>',sortOTHER2)
console.log('sortEventCalender:>',sortEventCalender)
sortList1=sortPO;sortList1=sortList1.concat(sortOTHER1);sortList1=sortList1.concat(sortOTHER2);this.sortedJsonArr=sortList1.concat(sortEventCalender);this.initCalendar();},initCalendar:function(){const s=this,$$afterCalendarRendered=()=>{s.curCalendarDate=s.$$calendarFunc.getDate();s.curCalendarDateUpdate();if(s.curCalendarDate_year<=this.today.getFullYear()&&s.curCalendarDate_month<=this.today.getMonth()+1){$('.fc-customprev-button').addClass('is-hide');}else{$('.fc-customprev-button').removeClass('is-hide');};if(s.curCalendarDate_year>=this.today.getFullYear()&&s.curCalendarDate_month>=this.today.getMonth()+2){$('.fc-customnext-button').addClass('is-hide');}else{$('.fc-customnext-button').removeClass('is-hide');};$('.fc-customprev-button').html(s.dateToTxt(s.$$calendarFunc.getDate(),'prev'));$('.fc-customnext-button').html(s.dateToTxt(s.$$calendarFunc.getDate(),'next'));$('.fc-toolbar-title').html(s.dateToTxt(s.$$calendarFunc.getDate(),''));$('.fc-daygrid-body').find('td').each((i,el)=>{if($(el).find('.fc-daygrid-event-harness')[0]){$(el).addClass('is-event');}})
s.outputEvents('month',s.curCalendarDate_str,'is-noScroll');s.$calendarBtn.removeClass('is-on');$('[data-calender-period="month"]').addClass('is-on')
if(s.curCalendarDate_year===this.today.getFullYear()&&s.curCalendarDate_month===this.today.getMonth()+1){$('[data-calender-period="month"]').find('.eventsCalender_btn_inr').html('今月のイベント');}else{$('[data-calender-period="month"]').find('.eventsCalender_btn_inr').html(this.texts['$$eventsListsTlEventtype']('month',s.curCalendarDate));}};let tmpArr=[],eventsArr=[];for(var i=0;i<this.sortedJsonArr.length;i++){let startdate=new Date(this.sortedJsonArr[i]['schedule_startdate']),enddate=new Date(this.sortedJsonArr[i]['schedule_enddate']);startDate=(this.today>=startdate?this.today:startdate);if(this.calendarEnddate<enddate)this.calendarEnddate=enddate;const term=Math.floor((enddate-startDate)/86400000)
for(let j=0,len2=term+1;j<len2;j++){let curDate=new Date(startDate.getTime());curDate.setDate(curDate.getDate()+j);let curDate_year=curDate.getFullYear(),curDate_month=curDate.getMonth()+1,curDate_date=curDate.getDate();curDate_month_Str=('0'+curDate_month).slice(-2);curDate_date_Str=('0'+curDate_date).slice(-2);curDate_str=`${curDate_year}-${curDate_month_Str}-${curDate_date_Str}`;if(tmpArr.indexOf(curDate_str)===-1){tmpArr.push(curDate_str);eventsArr.push({start:curDate_str,end:curDate_str});}}}
s.$$calendarFunc=new FullCalendar.Calendar(s.$calendar[0],{headerToolbar:{left:'customprev',center:'title',right:'customnext'},now:s.today_str,locale:'ja',dayCellContent:function(arg){return arg.date.getDate();},contentHeight:'auto',navLinks:false,businessHours:false,editable:false,selectable:false,customButtons:{customprev:{click:function(){s.$$calendarFunc.prev();$$afterCalendarRendered();}},customnext:{click:function(){s.$$calendarFunc.next();$$afterCalendarRendered();}}},events:eventsArr,eventClick:function(info){const date=$(info.el).parents('td').attr('data-date');s.$calendarBtn.removeClass('is-on');if(date===s.today_str){$('[data-calender-period="date"]').addClass('is-on');};s.outputEvents('date',date,'');}});s.$$calendarFunc.render();$$afterCalendarRendered();s.onResize();},dateToTxt:function(date,type){let curDate=new Date(date),curDate_txt;if(type==='prev'){curDate.setMonth(curDate.getMonth()-1);}else if(type==='next'){curDate.setMonth(curDate.getMonth()+1);}else{curDate.setMonth(curDate.getMonth());};curDate_txt=`<span class="nowrap">${curDate.getFullYear()}年</span><span class="nowrap"><span class="is-l">${curDate.getMonth() + 1}</span><span class="is-m">月</span></span>`;return curDate_txt;},curCalendarDateUpdate:function(){this.curCalendarDate_year=this.curCalendarDate.getFullYear();this.curCalendarDate_month=this.curCalendarDate.getMonth()+1;this.curCalendarDate_date=this.curCalendarDate.getDate();this.curCalendarDate_month_Str=('0'+this.curCalendarDate_month).slice(-2);this.curCalendarDate_date_Str=('0'+this.curCalendarDate_date).slice(-2);this.curCalendarDate_str=`${this.curCalendarDate_year}-${this.curCalendarDate_month_Str}-${this.curCalendarDate_date_Str}`;},onClickToday:function(){const s=this;},onClickMonth:function(){const s=this;},checkCategory:function(value){let txt='';if(value==='3'){txt='test3';};return txt;},onImgTag(data){let tag="";if(data['top_image']!==null){tag=`<img src="/cms_image/events/${data['top_image']}" width="" height="" alt="${data['top_image_alt']}" class="">`}else if(data['top_image']===null&&data['caption01image']!==null){tag=`<img src="/cms_image/events/${data['caption01image']}" width="" height="" alt="${data['caption01imagealt']}" class="">`}else{tag=`<img src="/_assets_rev03/images/page/events/img_sample.png" width="" height="" alt="" class="">`}
return tag;},outputEvents:function(type,date,otherFlgs){this.curCalendarType=type;this.curCalendarDate=new Date(date);this.curCalendarDateUpdate();let curArr={};let tempId=0;const s=this,$$returnHtml=(data)=>{let curHtml='';curHtml+=`
		  			<li class="eventsList" id="list-${data['newsid']}">

		  			`;if(data['direct_link']&&data['main_link']){curHtml+=`<a href="${data['main_link']}"${(String(data['is_blank']) === '1') ? ' target="_blank" rel="noopener"' : ''} class="eventsList_inr">`}else{curHtml+=`<a href="/${s.texts['centers'][s.curCalendarLocationid]['dir']}/events/news${data['newsid']}.html"${(String(data['is_blank']) === '1') ? ' target="_blank" rel="noopener"' : ''} class="eventsList_inr">`}
curHtml+=`
			  				<div class="eventsListCol">

				  				<div class="eventsListCol_img">
                    ${s.onImgTag(data)}
				  				</div>
				  				<div class="eventsListCol_txt">
				  	`;if(data['category']!=='9'&&data['category02']!==900){curHtml+=`
			  				<p class="eventsListCol_category is-category-${data['category']}">
			  					<span class="eventsListCol_category_inr">
			  						${s.texts['categoryType'][data['category02']]['name']}
			  					</span>
			  				</p>
			  			`;}
if(data['schedule']){curHtml+=`<p class="eventsListCol_schedule">${data['schedule']}</p>`}
curHtml+=`
				  					<h4 class="eventsListCol_tl">${data['title']}</h4>
		  			`;curHtml+=`
				  				</div>
			  				</div>
		  				</a>
		  			</li>
					`;return curHtml;};let html='',curDate,monthsStartDate,monthsEndDate;this.$eventsLists.empty();if(type==='date'){curDate=new Date(s.curCalendarDate);}else{monthsStartDate=new Date(`${this.curCalendarDate_year}-${this.curCalendarDate_month_Str}-01`);monthsEndDate=new Date(`${this.curCalendarDate_year}-${this.curCalendarDate_month_Str}-01T23:59:59`);monthsEndDate.setMonth(monthsEndDate.getMonth()+1);monthsEndDate.setDate(monthsEndDate.getDate()-1);};for(let i=0,len=this.sortedJsonArr.length;i<len;i++){const data=this.sortedJsonArr[i];let startdate=new Date(data['schedule_startdate']),enddate=new Date(data['schedule_enddate']);let flg=false;if(type==='date'){if(curDate>=startdate&&curDate<=enddate){flg=true;}}else{if((monthsStartDate>=startdate&&monthsEndDate<=enddate)||(monthsStartDate<=enddate&&monthsEndDate>=enddate)||(monthsStartDate<=startdate&&monthsEndDate>=startdate)){if(new Date(s.today.toDateString()).getTime()<=new Date(enddate.toDateString()).getTime()){flg=true;}}};if(flg){if(Number(data.newsid)!==Number(tempId))html+=$$returnHtml(data);tempId=data.newsid;}}
if(html===''){html=`<li class="eventsList is-noEvents">${this.texts['noEvents']}</li>`;};this.$eventsListsTlEventtype.html(this.texts['$$eventsListsTlEventtype'](s.curCalendarType,s.curCalendarDate));this.$eventsLists.html(html);console.log(this.isFirst);console.log(otherFlgs.indexOf('is-noScroll'));if(this.isFirst&&otherFlgs.indexOf('is-noScroll')===-1){$('html, body').animate({scrollTop:$('.eventsLists_wrapper').offset().top-$('.header').height()},300);}else{this.isFirst=true;};$('.eventsList').each((i,el)=>{setTimeout(()=>{$(el).addClass('is-on');},(120*i)+300);});}};window.Main=new Main();if(!window.console){window.console={};window.console.log=function(str){return str;};}})(jQuery,this);try{document.execCommand('BackgroundImageCache',false,true);}catch(e){};