
function InfoBox(opts){google.maps.OverlayView.call(this);this.latlng_=opts.latlng;this.map_=opts.map;this.offsetVertical_=-238;this.offsetHorizontal_=-20;this.height_=200;this.width_=171;this.sightseeingid=opts.sightseeing_id;this.sightseeing_title=opts.sightseeing_title;this.position_x=opts.position_x;this.position_y=opts.position_y;var me=this;this.boundsChangedListener_=google.maps.event.addListener(this.map_,"bounds_changed",function(){return me.panMap.apply(me);});this.setMap(this.map_);}
InfoBox.prototype=new google.maps.OverlayView();InfoBox.prototype.remove=function(){if(this.div_){this.div_.parentNode.removeChild(this.div_);this.div_=null;}};InfoBox.prototype.draw=function(){this.createElement();if(!this.div_)return;var pixPosition=this.getProjection().fromLatLngToDivPixel(this.latlng_);if(!pixPosition)return;this.div_.style.width=this.width_+"px";this.div_.style.left=(pixPosition.x+this.offsetHorizontal_)+"px";this.div_.style.top=(pixPosition.y+this.offsetVertical_)+"px";this.div_.style.display='block';};InfoBox.prototype.createElement=function(){var panes=this.getPanes();var div=this.div_;if(!div){div=this.div_=document.createElement("div");div.style.border="0px none";div.style.position="absolute";div.style.width=this.width_+"px";div.style.height=this.height_+"px";var contentDiv=document.createElement("div");contentDiv.style.padding="5px 5px 0 5px";contentDiv.style.position="relative";contentDiv.style.background="url('/_assets/images/common/tours/sightseeing/bg_info_t.png') no-repeat";var closeImg=document.createElement("img");closeImg.style.position="absolute";closeImg.style.top="7px";closeImg.style.right="7px";closeImg.style.width="14px";closeImg.style.height="13px";closeImg.style.cursor="pointer";closeImg.src="/_assets/images/common/tours/sightseeing/btn_close.gif";var _b=document.createElement("b");_b.innerHTML=this.sightseeing_title;_b.style.display="block";_b.style.padding="0 20px 0 0";_b.style.fontSize="90%";var _a=document.createElement("div");_a.innerHTML='<a class="info_b" onclick="COMMON.onPageScrollTo(\'#sight'+this.sightseeingid+'\', 1200, 0, 0);">詳細はこちら</a>';_a.style.textAlign="right";_a.style.fontSize="80%";_a.style.cursor="pointer";var innerDiv=document.createElement("div");innerDiv.style.width=this.width_+"px";innerDiv.style.position="absolute";innerDiv.style.left="0";innerDiv.style.bottom="0";var bottomDiv=document.createElement("div");bottomDiv.style.position="absolute";bottomDiv.style.bottom="-18px";bottomDiv.style.width=this.width_+"px";bottomDiv.style.height="18px";bottomDiv.style.background="url('/_assets/images/common/tours/sightseeing/bg_info_b.png') no-repeat";function removeInfoBox(ib){return function(){ib.setMap(null);};}
google.maps.event.addDomListener(closeImg,'click',removeInfoBox(this));contentDiv.appendChild(closeImg);contentDiv.appendChild(_b);contentDiv.appendChild(_a);innerDiv.appendChild(contentDiv);innerDiv.appendChild(bottomDiv);div.appendChild(innerDiv);div.style.display='none';panes.floatPane.appendChild(div);this.panMap();}else if(div.parentNode!=panes.floatPane){div.parentNode.removeChild(div);panes.floatPane.appendChild(div);}else{}}
InfoBox.prototype.panMap=function(){var map=this.map_;var bounds=map.getBounds();if(!bounds)return;var position=this.latlng_;var iwWidth=this.width_;var iwHeight=this.height_;var iwOffsetX=this.offsetHorizontal_;var iwOffsetY=this.offsetVertical_;var padX=40;var padY=40;var mapDiv=map.getDiv();var mapWidth=mapDiv.offsetWidth;var mapHeight=mapDiv.offsetHeight;var boundsSpan=bounds.toSpan();var longSpan=boundsSpan.lng();var latSpan=boundsSpan.lat();var degPixelX=longSpan/mapWidth;var degPixelY=latSpan/mapHeight;var mapWestLng=bounds.getSouthWest().lng();var mapEastLng=bounds.getNorthEast().lng();var mapNorthLat=bounds.getNorthEast().lat();var mapSouthLat=bounds.getSouthWest().lat();var iwWestLng=position.lng()+(iwOffsetX-padX)*degPixelX;var iwEastLng=position.lng()+(iwOffsetX+iwWidth+padX)*degPixelX;var iwNorthLat=position.lat()-(iwOffsetY-padY)*degPixelY;var iwSouthLat=position.lat()-(iwOffsetY+iwHeight+padY)*degPixelY;var shiftLng=(iwWestLng<mapWestLng?mapWestLng-iwWestLng:0)+
(iwEastLng>mapEastLng?mapEastLng-iwEastLng:0);var shiftLat=(iwNorthLat>mapNorthLat?mapNorthLat-iwNorthLat:0)+
(iwSouthLat<mapSouthLat?mapSouthLat-iwSouthLat:0);var center=map.getCenter();var centerX=center.lng()-shiftLng;var centerY=center.lat()-shiftLat;map.setCenter(new google.maps.LatLng(this.position_x,this.position_y));google.maps.event.removeListener(this.boundsChangedListener_);this.boundsChangedListener_=null;};